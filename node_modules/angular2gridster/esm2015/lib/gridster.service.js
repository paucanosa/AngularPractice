import { __decorate, __metadata } from "tslib";
import { Injectable } from '@angular/core';
import { Subject } from 'rxjs';
import { debounceTime } from 'rxjs/operators';
import { GridList } from './gridList/gridList';
let GridsterService = class GridsterService {
    constructor() {
        this.items = [];
        this._items = [];
        this._itemsMap = {};
        this.disabledItems = [];
        this.debounceRenderSubject = new Subject();
        this.itemRemoveSubject = new Subject();
        this.isInit = false;
        this.itemRemoveSubject.pipe(debounceTime(0)).subscribe(() => {
            this.gridList.pullItemsToLeft();
            this.render();
            this.updateCachedItems();
        });
        this.debounceRenderSubject.pipe(debounceTime(0)).subscribe(() => this.render());
    }
    isInitialized() {
        return this.isInit;
    }
    /**
     * Must be called before init
     * @param item
     */
    registerItem(item) {
        this.items.push(item);
        return item;
    }
    init(gridsterComponent) {
        this.gridsterComponent = gridsterComponent;
        this.draggableOptions = gridsterComponent.draggableOptions;
        this.gridsterOptions = gridsterComponent.gridsterOptions;
    }
    start() {
        this.updateMaxItemSize();
        // Used to highlight a position an element will land on upon drop
        if (this.$positionHighlight) {
            this.removePositionHighlight();
        }
        this.initGridList();
        this.isInit = true;
        setTimeout(() => {
            this.copyItems();
            this.fixItemsPositions();
            this.gridsterComponent.reflowGridster(true);
            this.gridsterComponent.setReady();
        });
    }
    initGridList() {
        // Create instance of GridList (decoupled lib for handling the grid
        // positioning and sorting post-drag and dropping)
        this.gridList = new GridList(this.items, this.options);
    }
    render() {
        this.updateMaxItemSize();
        this.gridList.generateGrid();
        this.applySizeToItems();
        this.applyPositionToItems();
        this.refreshLines();
    }
    reflow() {
        this.calculateCellSize();
        this.render();
    }
    fixItemsPositions() {
        if (this.options.responsiveSizes) {
            this.gridList.fixItemsPositions(this.options);
        }
        else {
            this.gridList.fixItemsPositions(this.gridsterOptions.basicOptions);
            this.gridsterOptions.responsiveOptions.forEach((options) => {
                this.gridList.fixItemsPositions(options);
            });
        }
        this.updateCachedItems();
    }
    removeItem(item) {
        const idx = this.items.indexOf(item);
        if (idx >= 0) {
            this.items.splice(this.items.indexOf(item), 1);
        }
        this.gridList.deleteItemPositionFromGrid(item);
        this.removeItemFromCache(item);
    }
    onResizeStart(item) {
        this.currentElement = item.$element;
        this.copyItems();
        this._maxGridCols = this.gridList.grid.length;
        this.highlightPositionForItem(item);
        this.gridsterComponent.isResizing = true;
        this.refreshLines();
    }
    onResizeDrag(item) {
        const newSize = this.snapItemSizeToGrid(item);
        const sizeChanged = this.dragSizeChanged(newSize);
        const newPosition = this.snapItemPositionToGrid(item);
        const positionChanged = this.dragPositionChanged(newPosition);
        if (sizeChanged || positionChanged) {
            // Regenerate the grid with the positions from when the drag started
            this.restoreCachedItems();
            this.gridList.generateGrid();
            this.previousDragPosition = newPosition;
            this.previousDragSize = newSize;
            this.gridList.moveAndResize(item, newPosition, { w: newSize[0], h: newSize[1] });
            // Visually update item positions and highlight shape
            this.applyPositionToItems(true);
            this.highlightPositionForItem(item);
        }
    }
    onResizeStop(item) {
        this.currentElement = undefined;
        this.updateCachedItems();
        this.previousDragSize = null;
        this.removePositionHighlight();
        this.gridsterComponent.isResizing = false;
        this.gridList.pullItemsToLeft(item);
        this.debounceRenderSubject.next();
        this.fixItemsPositions();
    }
    onStart(item) {
        this.currentElement = item.$element;
        // itemCtrl.isDragging = true;
        // Create a deep copy of the items; we use them to revert the item
        // positions after each drag change, making an entire drag operation less
        // distructable
        this.copyItems();
        // Since dragging actually alters the grid, we need to establish the number
        // of cols (+1 extra) before the drag starts
        this._maxGridCols = this.gridList.grid.length;
        this.gridsterComponent.isDragging = true;
        this.gridsterComponent.updateGridsterElementData();
        this.refreshLines();
    }
    onDrag(item) {
        const newPosition = this.snapItemPositionToGrid(item);
        if (this.dragPositionChanged(newPosition)) {
            // Regenerate the grid with the positions from when the drag started
            this.restoreCachedItems();
            this.gridList.generateGrid();
            this.previousDragPosition = newPosition;
            if (this.options.direction === 'none' &&
                !this.gridList.checkItemAboveEmptyArea(item, { x: newPosition[0], y: newPosition[1] })) {
                return;
            }
            // Since the items list is a deep copy, we need to fetch the item
            // corresponding to this drag action again
            this.gridList.moveItemToPosition(item, newPosition);
            // Visually update item positions and highlight shape
            this.applyPositionToItems(true);
            this.highlightPositionForItem(item);
        }
    }
    cancel() {
        this.restoreCachedItems();
        this.previousDragPosition = null;
        this.updateMaxItemSize();
        this.applyPositionToItems();
        this.removePositionHighlight();
        this.currentElement = undefined;
        this.gridsterComponent.isDragging = false;
    }
    onDragOut(item) {
        this.cancel();
        const idx = this.items.indexOf(item);
        if (idx >= 0) {
            this.items.splice(idx, 1);
        }
        this.gridList.pullItemsToLeft();
        this.render();
    }
    onStop(item) {
        this.currentElement = undefined;
        this.updateCachedItems();
        this.previousDragPosition = null;
        this.removePositionHighlight();
        this.gridList.pullItemsToLeft(item);
        this.gridsterComponent.isDragging = false;
        this.refreshLines();
    }
    calculateCellSize() {
        if (this.options.direction === 'horizontal') {
            this.cellHeight = this.calculateCellHeight();
            this.cellWidth = this.options.cellWidth || this.cellHeight * this.options.widthHeightRatio;
        }
        else {
            this.cellWidth = this.calculateCellWidth();
            this.cellHeight = this.options.cellHeight || this.cellWidth / this.options.widthHeightRatio;
        }
        if (this.options.heightToFontSizeRatio) {
            this._fontSize = this.cellHeight * this.options.heightToFontSizeRatio;
        }
    }
    applyPositionToItems(increaseGridsterSize) {
        if (!this.options.shrink) {
            increaseGridsterSize = true;
        }
        // TODO: Implement group separators
        for (let i = 0; i < this.items.length; i++) {
            // Don't interfere with the positions of the dragged items
            if (this.isCurrentElement(this.items[i].$element)) {
                continue;
            }
            this.items[i].applyPosition(this);
        }
        const child = this.gridsterComponent.$element.firstChild;
        // Update the width of the entire grid container with enough room on the
        // right to allow dragging items to the end of the grid.
        if (this.options.direction === 'horizontal') {
            const increaseWidthWith = (increaseGridsterSize) ? this.maxItemWidth : 0;
            child.style.height = '';
            child.style.width = ((this.gridList.grid.length + increaseWidthWith) * this.cellWidth) + 'px';
        }
        else if (this.gridList.grid.length) {
            const increaseHeightWith = (increaseGridsterSize) ? this.maxItemHeight : 0;
            child.style.height = ((this.gridList.grid.length + increaseHeightWith) * this.cellHeight) + 'px';
            child.style.width = '';
        }
    }
    refreshLines() {
        const gridsterContainer = this.gridsterComponent.$element.firstChild;
        if (this.options.lines && this.options.lines.visible &&
            (this.gridsterComponent.isDragging || this.gridsterComponent.isResizing || this.options.lines.always)) {
            const linesColor = this.options.lines.color || '#d8d8d8';
            const linesBgColor = this.options.lines.backgroundColor || 'transparent';
            const linesWidth = this.options.lines.width || 1;
            const bgPosition = linesWidth / 2;
            gridsterContainer.style.backgroundSize = `${this.cellWidth}px ${this.cellHeight}px`;
            gridsterContainer.style.backgroundPosition = `-${bgPosition}px -${bgPosition}px`;
            gridsterContainer.style.backgroundImage = `
                linear-gradient(to right, ${linesColor} ${linesWidth}px, ${linesBgColor} ${linesWidth}px),
                linear-gradient(to bottom, ${linesColor} ${linesWidth}px, ${linesBgColor} ${linesWidth}px)
            `;
        }
        else {
            gridsterContainer.style.backgroundSize = '';
            gridsterContainer.style.backgroundPosition = '';
            gridsterContainer.style.backgroundImage = '';
        }
    }
    removeItemFromCache(item) {
        this._items = this._items
            .filter(cachedItem => cachedItem.$element !== item.$element);
        Object.keys(this._itemsMap)
            .forEach((breakpoint) => {
            this._itemsMap[breakpoint] = this._itemsMap[breakpoint]
                .filter(cachedItem => cachedItem.$element !== item.$element);
        });
    }
    copyItems() {
        this._items = this.items
            .filter(item => this.isValidGridItem(item))
            .map((item) => {
            return item.copyForBreakpoint(null);
        });
        this.gridsterOptions.responsiveOptions.forEach((options) => {
            this._itemsMap[options.breakpoint] = this.items
                .filter(item => this.isValidGridItem(item))
                .map((item) => {
                return item.copyForBreakpoint(options.breakpoint);
            });
        });
    }
    /**
     * Update maxItemWidth and maxItemHeight vales according to current state of items
     */
    updateMaxItemSize() {
        this.maxItemWidth = Math.max.apply(null, this.items.map((item) => {
            return item.w;
        }));
        this.maxItemHeight = Math.max.apply(null, this.items.map((item) => {
            return item.h;
        }));
    }
    /**
     * Update items properties of previously cached items
     */
    restoreCachedItems() {
        const items = this.options.breakpoint ? this._itemsMap[this.options.breakpoint] : this._items;
        this.items
            .filter(item => this.isValidGridItem(item))
            .forEach((item) => {
            const cachedItem = items.filter(cachedItm => {
                return cachedItm.$element === item.$element;
            })[0];
            item.x = cachedItem.x;
            item.y = cachedItem.y;
            item.w = cachedItem.w;
            item.h = cachedItem.h;
            item.autoSize = cachedItem.autoSize;
        });
    }
    /**
     * If item should react on grid
     * @param GridListItem item
     * @returns boolean
     */
    isValidGridItem(item) {
        if (this.options.direction === 'none') {
            return !!item.itemComponent;
        }
        return true;
    }
    calculateCellWidth() {
        const gridsterWidth = parseFloat(window.getComputedStyle(this.gridsterComponent.$element).width);
        return gridsterWidth / this.options.lanes;
    }
    calculateCellHeight() {
        const gridsterHeight = parseFloat(window.getComputedStyle(this.gridsterComponent.$element).height);
        return gridsterHeight / this.options.lanes;
    }
    applySizeToItems() {
        for (let i = 0; i < this.items.length; i++) {
            this.items[i].applySize();
            if (this.options.heightToFontSizeRatio) {
                this.items[i].$element.style['font-size'] = this._fontSize;
            }
        }
    }
    isCurrentElement(element) {
        if (!this.currentElement) {
            return false;
        }
        return element === this.currentElement;
    }
    snapItemSizeToGrid(item) {
        const itemSize = {
            width: parseInt(item.$element.style.width, 10) - 1,
            height: parseInt(item.$element.style.height, 10) - 1
        };
        let colSize = Math.round(itemSize.width / this.cellWidth);
        let rowSize = Math.round(itemSize.height / this.cellHeight);
        // Keep item minimum 1
        colSize = Math.max(colSize, 1);
        rowSize = Math.max(rowSize, 1);
        // check if element is pinned
        if (this.gridList.isOverFixedArea(item.x, item.y, colSize, rowSize, item)) {
            return [item.w, item.h];
        }
        return [colSize, rowSize];
    }
    generateItemPosition(item) {
        let position;
        if (item.itemPrototype) {
            const coords = item.itemPrototype.getPositionToGridster(this);
            position = {
                x: Math.round(coords.x / this.cellWidth),
                y: Math.round(coords.y / this.cellHeight)
            };
        }
        else {
            position = {
                x: Math.round(item.positionX / this.cellWidth),
                y: Math.round(item.positionY / this.cellHeight)
            };
        }
        return position;
    }
    snapItemPositionToGrid(item) {
        const position = this.generateItemPosition(item);
        let col = position.x;
        let row = position.y;
        // Keep item position within the grid and don't let the item create more
        // than one extra column
        col = Math.max(col, 0);
        row = Math.max(row, 0);
        if (this.options.direction === 'horizontal') {
            col = Math.min(col, this._maxGridCols);
        }
        else {
            col = Math.min(col, Math.max(0, this.options.lanes - item.w));
        }
        // check if element is pinned
        if (this.gridList.isOverFixedArea(col, row, item.w, item.h)) {
            return [item.x, item.y];
        }
        return [col, row];
    }
    dragSizeChanged(newSize) {
        if (!this.previousDragSize) {
            return true;
        }
        return (newSize[0] !== this.previousDragSize[0] ||
            newSize[1] !== this.previousDragSize[1]);
    }
    dragPositionChanged(newPosition) {
        if (!this.previousDragPosition) {
            return true;
        }
        return (newPosition[0] !== this.previousDragPosition[0] ||
            newPosition[1] !== this.previousDragPosition[1]);
    }
    highlightPositionForItem(item) {
        const size = item.calculateSize(this);
        const position = item.calculatePosition(this);
        this.$positionHighlight.style.width = size.width + 'px';
        this.$positionHighlight.style.height = size.height + 'px';
        this.$positionHighlight.style.left = position.left + 'px';
        this.$positionHighlight.style.top = position.top + 'px';
        this.$positionHighlight.style.display = '';
        if (this.options.heightToFontSizeRatio) {
            this.$positionHighlight.style['font-size'] = this._fontSize;
        }
    }
    updateCachedItems() {
        // Notify the user with the items that changed since the previous snapshot
        this.triggerOnChange(null);
        this.gridsterOptions.responsiveOptions.forEach((options) => {
            this.triggerOnChange(options.breakpoint);
        });
        this.copyItems();
    }
    triggerOnChange(breakpoint) {
        const items = breakpoint ? this._itemsMap[breakpoint] : this._items;
        const changeItems = this.gridList.getChangedItems(items || [], breakpoint);
        changeItems
            .filter((itemChange) => {
            return itemChange.item.itemComponent;
        })
            .forEach((itemChange) => {
            if (itemChange.changes.indexOf('x') >= 0) {
                itemChange.item.triggerChangeX(breakpoint);
            }
            if (itemChange.changes.indexOf('y') >= 0) {
                itemChange.item.triggerChangeY(breakpoint);
            }
            if (itemChange.changes.indexOf('w') >= 0) {
                itemChange.item.triggerChangeW(breakpoint);
            }
            if (itemChange.changes.indexOf('h') >= 0) {
                itemChange.item.triggerChangeH(breakpoint);
            }
            // should be called only once (not for each breakpoint)
            itemChange.item.itemComponent.change.emit({
                item: itemChange.item,
                oldValues: itemChange.oldValues || {},
                isNew: itemChange.isNew,
                changes: itemChange.changes,
                breakpoint: breakpoint
            });
        });
    }
    removePositionHighlight() {
        this.$positionHighlight.style.display = 'none';
    }
};
GridsterService = __decorate([
    Injectable(),
    __metadata("design:paramtypes", [])
], GridsterService);
export { GridsterService };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZ3JpZHN0ZXIuc2VydmljZS5qcyIsInNvdXJjZVJvb3QiOiJuZzovL2FuZ3VsYXIyZ3JpZHN0ZXIvIiwic291cmNlcyI6WyJsaWIvZ3JpZHN0ZXIuc2VydmljZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiO0FBQUEsT0FBTyxFQUFFLFVBQVUsRUFBRSxNQUFNLGVBQWUsQ0FBQztBQUMzQyxPQUFPLEVBQUUsT0FBTyxFQUFFLE1BQU0sTUFBTSxDQUFDO0FBQy9CLE9BQU8sRUFBRSxZQUFZLEVBQUUsTUFBTSxnQkFBZ0IsQ0FBQztBQUU5QyxPQUFPLEVBQUUsUUFBUSxFQUFFLE1BQU0scUJBQXFCLENBQUM7QUFRL0MsSUFBYSxlQUFlLEdBQTVCLE1BQWEsZUFBZTtJQTJDeEI7UUF0Q0EsVUFBSyxHQUF3QixFQUFFLENBQUM7UUFDaEMsV0FBTSxHQUF3QixFQUFFLENBQUM7UUFDakMsY0FBUyxHQUFrRCxFQUFFLENBQUM7UUFDOUQsa0JBQWEsR0FBd0IsRUFBRSxDQUFDO1FBWXhDLDBCQUFxQixHQUFHLElBQUksT0FBTyxFQUFFLENBQUM7UUFVL0Isc0JBQWlCLEdBQTBCLElBQUksT0FBTyxFQUFFLENBQUM7UUFXeEQsV0FBTSxHQUFHLEtBQUssQ0FBQztRQUduQixJQUFJLENBQUMsaUJBQWlCLENBQUMsSUFBSSxDQUFDLFlBQVksQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLFNBQVMsQ0FBQyxHQUFHLEVBQUU7WUFDeEQsSUFBSSxDQUFDLFFBQVEsQ0FBQyxlQUFlLEVBQUUsQ0FBQztZQUNoQyxJQUFJLENBQUMsTUFBTSxFQUFFLENBQUM7WUFDZCxJQUFJLENBQUMsaUJBQWlCLEVBQUUsQ0FBQztRQUM3QixDQUFDLENBQUMsQ0FBQztRQUVILElBQUksQ0FBQyxxQkFBcUIsQ0FBQyxJQUFJLENBQUMsWUFBWSxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsU0FBUyxDQUFDLEdBQUcsRUFBRSxDQUFDLElBQUksQ0FBQyxNQUFNLEVBQUUsQ0FBQyxDQUFDO0lBQ3BG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QUUsVUFBVSxDQUFDLElBQUk7Z0JBQ3JCLFNBQVMsRUFBRSxVQUFVLENBQUMsU0FBUyxJQUFJLEVBQUU7Z0JBQ3JDLEtBQUssRUFBRSxVQUFVLENBQUMsS0FBSztnQkFDdkIsT0FBTyxFQUFFLFVBQVUsQ0FBQyxPQUFPO2dCQUMzQixVQUFVLEVBQUUsVUFBVTthQUN6QixDQUFDLENBQUM7UUFDUCxDQUFDLENBQUMsQ0FBQztJQUNYLENBQUM7SUFFTyx1QkFBdUI7UUFDM0IsSUFBSSxDQUFDLGtCQUFrQixDQUFDLEtBQUssQ0FBQyxPQUFPLEdBQUcsTUFBTSxDQUFDO0lBQ25ELENBQUM7Q0FFSixDQUFBO0FBdGtCWSxlQUFlO0lBRDNCLFVBQVUsRUFBRTs7R0FDQSxlQUFlLENBc2tCM0I7U0F0a0JZLGVBQWUiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBJbmplY3RhYmxlIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5pbXBvcnQgeyBTdWJqZWN0IH0gZnJvbSAncnhqcyc7XG5pbXBvcnQgeyBkZWJvdW5jZVRpbWUgfSBmcm9tICdyeGpzL29wZXJhdG9ycyc7XG5cbmltcG9ydCB7IEdyaWRMaXN0IH0gZnJvbSAnLi9ncmlkTGlzdC9ncmlkTGlzdCc7XG5pbXBvcnQgeyBJR3JpZHN0ZXJPcHRpb25zIH0gZnJvbSAnLi9JR3JpZHN0ZXJPcHRpb25zJztcbmltcG9ydCB7IElHcmlkc3RlckRyYWdnYWJsZU9wdGlvbnMgfSBmcm9tICcuL0lHcmlkc3RlckRyYWdnYWJsZU9wdGlvbnMnO1xuaW1wb3J0IHsgR3JpZExpc3RJdGVtIH0gZnJvbSAnLi9ncmlkTGlzdC9HcmlkTGlzdEl0ZW0nO1xuaW1wb3J0IHsgR3JpZHN0ZXJDb21wb25lbnQgfSBmcm9tICcuL2dyaWRzdGVyLmNvbXBvbmVudCc7XG5pbXBvcnQgeyBHcmlkc3Rlck9wdGlvbnMgfSBmcm9tICcuL0dyaWRzdGVyT3B0aW9ucyc7XG5cbkBJbmplY3RhYmxlKClcbmV4cG9ydCBjbGFzcyBHcmlkc3RlclNlcnZpY2Uge1xuICAgICRlbGVtZW50OiBIVE1MRWxlbWVudDtcblxuICAgIGdyaWRMaXN0OiBHcmlkTGlzdDtcblxuICAgIGl0ZW1zOiBBcnJheTxHcmlkTGlzdEl0ZW0+ID0gW107XG4gICAgX2l0ZW1zOiBBcnJheTxHcmlkTGlzdEl0ZW0+ID0gW107XG4gICAgX2l0ZW1zTWFwOiB7IFticmVha3BvaW50OiBzdHJpbmddOiBBcnJheTxHcmlkTGlzdEl0ZW0+IH0gPSB7fTtcbiAgICBkaXNhYmxlZEl0ZW1zOiBBcnJheTxHcmlkTGlzdEl0ZW0+ID0gW107XG5cbiAgICBvcHRpb25zOiBJR3JpZHN0ZXJPcHRpb25zO1xuICAgIGRyYWdnYWJsZU9wdGlvbnM6IElHcmlkc3RlckRyYWdnYWJsZU9wdGlvbnM7XG5cbiAgICBncmlkc3RlclJlY3Q6IENsaWVudFJlY3Q7XG4gICAgZ3JpZHN0ZXJTY3JvbGxEYXRhOiB7IHNjcm9sbFRvcDogbnVtYmVyLCBzY3JvbGxMZWZ0OiBudW1iZXIgfTtcblxuICAgIGdyaWRzdGVyT3B0aW9uczogR3JpZHN0ZXJPcHRpb25zO1xuXG4gICAgZ3JpZHN0ZXJDb21wb25lbnQ6IEdyaWRzdGVyQ29tcG9uZW50O1xuXG4gICAgZGVib3VuY2VSZW5kZXJTdWJqZWN0ID0gbmV3IFN1YmplY3QoKTtcblxuICAgIHB1YmxpYyAkcG9zaXRpb25IaWdobGlnaHQ6IEhUTUxFbGVtZW50O1xuXG4gICAgcHVibGljIG1heEl0ZW1XaWR0aDogbnVtYmVyO1xuICAgIHB1YmxpYyBtYXhJdGVtSGVpZ2h0OiBudW1iZXI7XG5cbiAgICBwdWJsaWMgY2VsbFdpZHRoOiBudW1iZXI7XG4gICAgcHVibGljIGNlbGxIZWlnaHQ6IG51bWJlcjtcblxuICAgIHB1YmxpYyBpdGVtUmVtb3ZlU3ViamVjdDogU3ViamVjdDxHcmlkTGlzdEl0ZW0+ID0gbmV3IFN1YmplY3QoKTtcblxuICAgIHByaXZhdGUgX2ZvbnRTaXplOiBudW1iZXI7XG5cbiAgICBwcml2YXRlIHByZXZpb3VzRHJhZ1Bvc2l0aW9uOiBBcnJheTxudW1iZXI+O1xuICAgIHByaXZhdGUgcHJldmlvdXNEcmFnU2l6ZTogQXJyYXk8bnVtYmVyPjtcblxuICAgIHByaXZhdGUgY3VycmVudEVsZW1lbnQ6IEhUTUxFbGVtZW50O1xuXG4gICAgcHJpdmF0ZSBfbWF4R3JpZENvbHM6IG51bWJlcjtcblxuICAgIHByaXZhdGUgaXNJbml0ID0gZmFsc2U7XG5cbiAgICBjb25zdHJ1Y3RvcigpIHtcbiAgICAgICAgdGhpcy5pdGVtUmVtb3ZlU3ViamVjdC5waXBlKGRlYm91bmNlVGltZSgwKSkuc3Vic2NyaWJlKCgpID0+IHtcbiAgICAgICAgICAgIHRoaXMuZ3JpZExpc3QucHVsbEl0ZW1zVG9MZWZ0KCk7XG4gICAgICAgICAgICB0aGlzLnJlbmRlcigpO1xuICAgICAgICAgICAgdGhpcy51cGRhdGVDYWNoZWRJdGVtcygpO1xuICAgICAgICB9KTtcblxuICAgICAgICB0aGlzLmRlYm91bmNlUmVuZGVyU3ViamVjdC5waXBlKGRlYm91bmNlVGltZSgwKSkuc3Vic2NyaWJlKCgpID0+IHRoaXMucmVuZGVyKCkpO1xuICAgIH1cblxuICAgIGlzSW5pdGlhbGl6ZWQoKTogYm9vbGVhbiB7XG4gICAgICAgIHJldHVybiB0aGlzLmlzSW5pdDtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBNdXN0IGJlIGNhbGxlZCBiZWZvcmUgaW5pdFxuICAgICAqIEBwYXJhbSBpdGVtXG4gICAgICovXG4gICAgcmVnaXN0ZXJJdGVtKGl0ZW06IEdyaWRMaXN0SXRlbSkge1xuXG4gICAgICAgIHRoaXMuaXRlbXMucHVzaChpdGVtKTtcbiAgICAgICAgcmV0dXJuIGl0ZW07XG4gICAgfVxuXG4gICAgaW5pdChncmlkc3RlckNvbXBvbmVudDogR3JpZHN0ZXJDb21wb25lbnQpIHtcblxuICAgICAgICB0aGlzLmdyaWRzdGVyQ29tcG9uZW50ID0gZ3JpZHN0ZXJDb21wb25lbnQ7XG5cbiAgICAgICAgdGhpcy5kcmFnZ2FibGVPcHRpb25zID0gZ3JpZHN0ZXJDb21wb25lbnQuZHJhZ2dhYmxlT3B0aW9ucztcblxuICAgICAgICB0aGlzLmdyaWRzdGVyT3B0aW9ucyA9IGdyaWRzdGVyQ29tcG9uZW50LmdyaWRzdGVyT3B0aW9ucztcbiAgICB9XG5cbiAgICBzdGFydCgpIHtcbiAgICAgICAgdGhpcy51cGRhdGVNYXhJdGVtU2l6ZSgpO1xuXG4gICAgICAgIC8vIFVzZWQgdG8gaGlnaGxpZ2h0IGEgcG9zaXRpb24gYW4gZWxlbWVudCB3aWxsIGxhbmQgb24gdXBvbiBkcm9wXG4gICAgICAgIGlmICh0aGlzLiRwb3NpdGlvbkhpZ2hsaWdodCkge1xuICAgICAgICAgICAgdGhpcy5yZW1vdmVQb3NpdGlvbkhpZ2hsaWdodCgpO1xuICAgICAgICB9XG5cbiAgICAgICAgdGhpcy5pbml0R3JpZExpc3QoKTtcblxuICAgICAgICB0aGlzLmlzSW5pdCA9IHRydWU7XG5cbiAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7XG4gICAgICAgICAgICB0aGlzLmNvcHlJdGVtcygpO1xuICAgICAgICAgICAgdGhpcy5maXhJdGVtc1Bvc2l0aW9ucygpO1xuXG4gICAgICAgICAgICB0aGlzLmdyaWRzdGVyQ29tcG9uZW50LnJlZmxvd0dyaWRzdGVyKHRydWUpO1xuICAgICAgICAgICAgdGhpcy5ncmlkc3RlckNvbXBvbmVudC5zZXRSZWFkeSgpO1xuICAgICAgICB9KTtcbiAgICB9XG5cbiAgICBpbml0R3JpZExpc3QoKSB7XG4gICAgICAgIC8vIENyZWF0ZSBpbnN0YW5jZSBvZiBHcmlkTGlzdCAoZGVjb3VwbGVkIGxpYiBmb3IgaGFuZGxpbmcgdGhlIGdyaWRcbiAgICAgICAgLy8gcG9zaXRpb25pbmcgYW5kIHNvcnRpbmcgcG9zdC1kcmFnIGFuZCBkcm9wcGluZylcbiAgICAgICAgdGhpcy5ncmlkTGlzdCA9IG5ldyBHcmlkTGlzdCh0aGlzLml0ZW1zLCB0aGlzLm9wdGlvbnMpO1xuICAgIH1cblxuICAgIHJlbmRlcigpIHtcbiAgICAgICAgdGhpcy51cGRhdGVNYXhJdGVtU2l6ZSgpO1xuICAgICAgICB0aGlzLmdyaWRMaXN0LmdlbmVyYXRlR3JpZCgpO1xuICAgICAgICB0aGlzLmFwcGx5U2l6ZVRvSXRlbXMoKTtcbiAgICAgICAgdGhpcy5hcHBseVBvc2l0aW9uVG9JdGVtcygpO1xuICAgICAgICB0aGlzLnJlZnJlc2hMaW5lcygpO1xuICAgIH1cblxuICAgIHJlZmxvdygpIHtcbiAgICAgICAgdGhpcy5jYWxjdWxhdGVDZWxsU2l6ZSgpO1xuICAgICAgICB0aGlzLnJlbmRlcigpO1xuICAgIH1cblxuICAgIGZpeEl0ZW1zUG9zaXRpb25zKCkge1xuICAgICAgICBpZiAodGhpcy5vcHRpb25zLnJlc3BvbnNpdmVTaXplcykge1xuICAgICAgICAgICAgdGhpcy5ncmlkTGlzdC5maXhJdGVtc1Bvc2l0aW9ucyh0aGlzLm9wdGlvbnMpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdGhpcy5ncmlkTGlzdC5maXhJdGVtc1Bvc2l0aW9ucyh0aGlzLmdyaWRzdGVyT3B0aW9ucy5iYXNpY09wdGlvbnMpO1xuICAgICAgICAgICAgdGhpcy5ncmlkc3Rlck9wdGlvbnMucmVzcG9uc2l2ZU9wdGlvbnMuZm9yRWFjaCgob3B0aW9uczogSUdyaWRzdGVyT3B0aW9ucykgPT4ge1xuICAgICAgICAgICAgICAgIHRoaXMuZ3JpZExpc3QuZml4SXRlbXNQb3NpdGlvbnMob3B0aW9ucyk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuXG4gICAgICAgIHRoaXMudXBkYXRlQ2FjaGVkSXRlbXMoKTtcbiAgICB9XG5cbiAgICByZW1vdmVJdGVtKGl0ZW06IEdyaWRMaXN0SXRlbSkge1xuICAgICAgICBjb25zdCBpZHggPSB0aGlzLml0ZW1zLmluZGV4T2YoaXRlbSk7XG5cbiAgICAgICAgaWYgKGlkeCA+PSAwKSB7XG4gICAgICAgICAgICB0aGlzLml0ZW1zLnNwbGljZSh0aGlzLml0ZW1zLmluZGV4T2YoaXRlbSksIDEpO1xuICAgICAgICB9XG5cbiAgICAgICAgdGhpcy5ncmlkTGlzdC5kZWxldGVJdGVtUG9zaXRpb25Gcm9tR3JpZChpdGVtKTtcbiAgICAgICAgdGhpcy5yZW1vdmVJdGVtRnJvbUNhY2hlKGl0ZW0pO1xuICAgIH1cblxuICAgIG9uUmVzaXplU3RhcnQoaXRlbTogR3JpZExpc3RJdGVtKSB7XG4gICAgICAgIHRoaXMuY3VycmVudEVsZW1lbnQgPSBpdGVtLiRlbGVtZW50O1xuXG4gICAgICAgIHRoaXMuY29weUl0ZW1zKCk7XG5cbiAgICAgICAgdGhpcy5fbWF4R3JpZENvbHMgPSB0aGlzLmdyaWRMaXN0LmdyaWQubGVuZ3RoO1xuXG4gICAgICAgIHRoaXMuaGlnaGxpZ2h0UG9zaXRpb25Gb3JJdGVtKGl0ZW0pO1xuXG4gICAgICAgIHRoaXMuZ3JpZHN0ZXJDb21wb25lbnQuaXNSZXNpemluZyA9IHRydWU7XG5cbiAgICAgICAgdGhpcy5yZWZyZXNoTGluZXMoKTtcbiAgICB9XG5cbiAgICBvblJlc2l6ZURyYWcoaXRlbTogR3JpZExpc3RJdGVtKSB7XG4gICAgICAgIGNvbnN0IG5ld1NpemUgPSB0aGlzLnNuYXBJdGVtU2l6ZVRvR3JpZChpdGVtKTtcbiAgICAgICAgY29uc3Qgc2l6ZUNoYW5nZWQgPSB0aGlzLmRyYWdTaXplQ2hhbmdlZChuZXdTaXplKTtcbiAgICAgICAgY29uc3QgbmV3UG9zaXRpb24gPSB0aGlzLnNuYXBJdGVtUG9zaXRpb25Ub0dyaWQoaXRlbSk7XG4gICAgICAgIGNvbnN0IHBvc2l0aW9uQ2hhbmdlZCA9IHRoaXMuZHJhZ1Bvc2l0aW9uQ2hhbmdlZChuZXdQb3NpdGlvbik7XG5cbiAgICAgICAgaWYgKHNpemVDaGFuZ2VkIHx8IHBvc2l0aW9uQ2hhbmdlZCkge1xuICAgICAgICAgICAgLy8gUmVnZW5lcmF0ZSB0aGUgZ3JpZCB3aXRoIHRoZSBwb3NpdGlvbnMgZnJvbSB3aGVuIHRoZSBkcmFnIHN0YXJ0ZWRcbiAgICAgICAgICAgIHRoaXMucmVzdG9yZUNhY2hlZEl0ZW1zKCk7XG4gICAgICAgICAgICB0aGlzLmdyaWRMaXN0LmdlbmVyYXRlR3JpZCgpO1xuXG4gICAgICAgICAgICB0aGlzLnByZXZpb3VzRHJhZ1Bvc2l0aW9uID0gbmV3UG9zaXRpb247XG4gICAgICAgICAgICB0aGlzLnByZXZpb3VzRHJhZ1NpemUgPSBuZXdTaXplO1xuXG4gICAgICAgICAgICB0aGlzLmdyaWRMaXN0Lm1vdmVBbmRSZXNpemUoaXRlbSwgbmV3UG9zaXRpb24sIHt3OiBuZXdTaXplWzBdLCBoOiBuZXdTaXplWzFdfSk7XG5cbiAgICAgICAgICAgIC8vIFZpc3VhbGx5IHVwZGF0ZSBpdGVtIHBvc2l0aW9ucyBhbmQgaGlnaGxpZ2h0IHNoYXBlXG4gICAgICAgICAgICB0aGlzLmFwcGx5UG9zaXRpb25Ub0l0ZW1zKHRydWUpO1xuICAgICAgICAgICAgdGhpcy5oaWdobGlnaHRQb3NpdGlvbkZvckl0ZW0oaXRlbSk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBvblJlc2l6ZVN0b3AoaXRlbTogR3JpZExpc3RJdGVtKSB7XG4gICAgICAgIHRoaXMuY3VycmVudEVsZW1lbnQgPSB1bmRlZmluZWQ7XG4gICAgICAgIHRoaXMudXBkYXRlQ2FjaGVkSXRlbXMoKTtcbiAgICAgICAgdGhpcy5wcmV2aW91c0RyYWdTaXplID0gbnVsbDtcblxuICAgICAgICB0aGlzLnJlbW92ZVBvc2l0aW9uSGlnaGxpZ2h0KCk7XG5cbiAgICAgICAgdGhpcy5ncmlkc3RlckNvbXBvbmVudC5pc1Jlc2l6aW5nID0gZmFsc2U7XG5cbiAgICAgICAgdGhpcy5ncmlkTGlzdC5wdWxsSXRlbXNUb0xlZnQoaXRlbSk7XG4gICAgICAgIHRoaXMuZGVib3VuY2VSZW5kZXJTdWJqZWN0Lm5leHQoKTtcblxuICAgICAgICB0aGlzLmZpeEl0ZW1zUG9zaXRpb25zKCk7XG4gICAgfVxuXG4gICAgb25TdGFydChpdGVtOiBHcmlkTGlzdEl0ZW0pIHtcbiAgICAgICAgdGhpcy5jdXJyZW50RWxlbWVudCA9IGl0ZW0uJGVsZW1lbnQ7XG4gICAgICAgIC8vIGl0ZW1DdHJsLmlzRHJhZ2dpbmcgPSB0cnVlO1xuICAgICAgICAvLyBDcmVhdGUgYSBkZWVwIGNvcHkgb2YgdGhlIGl0ZW1zOyB3ZSB1c2UgdGhlbSB0byByZXZlcnQgdGhlIGl0ZW1cbiAgICAgICAgLy8gcG9zaXRpb25zIGFmdGVyIGVhY2ggZHJhZyBjaGFuZ2UsIG1ha2luZyBhbiBlbnRpcmUgZHJhZyBvcGVyYXRpb24gbGVzc1xuICAgICAgICAvLyBkaXN0cnVjdGFibGVcbiAgICAgICAgdGhpcy5jb3B5SXRlbXMoKTtcblxuICAgICAgICAvLyBTaW5jZSBkcmFnZ2luZyBhY3R1YWxseSBhbHRlcnMgdGhlIGdyaWQsIHdlIG5lZWQgdG8gZXN0YWJsaXNoIHRoZSBudW1iZXJcbiAgICAgICAgLy8gb2YgY29scyAoKzEgZXh0cmEpIGJlZm9yZSB0aGUgZHJhZyBzdGFydHNcblxuICAgICAgICB0aGlzLl9tYXhHcmlkQ29scyA9IHRoaXMuZ3JpZExpc3QuZ3JpZC5sZW5ndGg7XG5cbiAgICAgICAgdGhpcy5ncmlkc3RlckNvbXBvbmVudC5pc0RyYWdnaW5nID0gdHJ1ZTtcbiAgICAgICAgdGhpcy5ncmlkc3RlckNvbXBvbmVudC51cGRhdGVHcmlkc3RlckVsZW1lbnREYXRhKCk7XG5cbiAgICAgICAgdGhpcy5yZWZyZXNoTGluZXMoKTtcbiAgICB9XG5cbiAgICBvbkRyYWcoaXRlbTogR3JpZExpc3RJdGVtKSB7XG4gICAgICAgIGNvbnN0IG5ld1Bvc2l0aW9uID0gdGhpcy5zbmFwSXRlbVBvc2l0aW9uVG9HcmlkKGl0ZW0pO1xuXG4gICAgICAgIGlmICh0aGlzLmRyYWdQb3NpdGlvbkNoYW5nZWQobmV3UG9zaXRpb24pKSB7XG5cbiAgICAgICAgICAgIC8vIFJlZ2VuZXJhdGUgdGhlIGdyaWQgd2l0aCB0aGUgcG9zaXRpb25zIGZyb20gd2hlbiB0aGUgZHJhZyBzdGFydGVkXG4gICAgICAgICAgICB0aGlzLnJlc3RvcmVDYWNoZWRJdGVtcygpO1xuICAgICAgICAgICAgdGhpcy5ncmlkTGlzdC5nZW5lcmF0ZUdyaWQoKTtcblxuICAgICAgICAgICAgdGhpcy5wcmV2aW91c0RyYWdQb3NpdGlvbiA9IG5ld1Bvc2l0aW9uO1xuICAgICAgICAgICAgaWYgKHRoaXMub3B0aW9ucy5kaXJlY3Rpb24gPT09ICdub25lJyAmJlxuICAgICAgICAgICAgICAgICF0aGlzLmdyaWRMaXN0LmNoZWNrSXRlbUFib3ZlRW1wdHlBcmVhKGl0ZW0sIHt4OiBuZXdQb3NpdGlvblswXSwgeTogbmV3UG9zaXRpb25bMV19KSkge1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgLy8gU2luY2UgdGhlIGl0ZW1zIGxpc3QgaXMgYSBkZWVwIGNvcHksIHdlIG5lZWQgdG8gZmV0Y2ggdGhlIGl0ZW1cbiAgICAgICAgICAgIC8vIGNvcnJlc3BvbmRpbmcgdG8gdGhpcyBkcmFnIGFjdGlvbiBhZ2FpblxuICAgICAgICAgICAgdGhpcy5ncmlkTGlzdC5tb3ZlSXRlbVRvUG9zaXRpb24oaXRlbSwgbmV3UG9zaXRpb24pO1xuXG4gICAgICAgICAgICAvLyBWaXN1YWxseSB1cGRhdGUgaXRlbSBwb3NpdGlvbnMgYW5kIGhpZ2hsaWdodCBzaGFwZVxuICAgICAgICAgICAgdGhpcy5hcHBseVBvc2l0aW9uVG9JdGVtcyh0cnVlKTtcbiAgICAgICAgICAgIHRoaXMuaGlnaGxpZ2h0UG9zaXRpb25Gb3JJdGVtKGl0ZW0pO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgY2FuY2VsKCkge1xuICAgICAgICB0aGlzLnJlc3RvcmVDYWNoZWRJdGVtcygpO1xuICAgICAgICB0aGlzLnByZXZpb3VzRHJhZ1Bvc2l0aW9uID0gbnVsbDtcbiAgICAgICAgdGhpcy51cGRhdGVNYXhJdGVtU2l6ZSgpO1xuICAgICAgICB0aGlzLmFwcGx5UG9zaXRpb25Ub0l0ZW1zKCk7XG4gICAgICAgIHRoaXMucmVtb3ZlUG9zaXRpb25IaWdobGlnaHQoKTtcbiAgICAgICAgdGhpcy5jdXJyZW50RWxlbWVudCA9IHVuZGVmaW5lZDtcbiAgICAgICAgdGhpcy5ncmlkc3RlckNvbXBvbmVudC5pc0RyYWdnaW5nID0gZmFsc2U7XG4gICAgfVxuXG4gICAgb25EcmFnT3V0IChpdGVtOiBHcmlkTGlzdEl0ZW0pIHtcblxuICAgICAgICB0aGlzLmNhbmNlbCgpO1xuXG4gICAgICAgIGNvbnN0IGlkeCA9IHRoaXMuaXRlbXMuaW5kZXhPZihpdGVtKTtcbiAgICAgICAgaWYgKGlkeCA+PSAwKSB7XG4gICAgICAgICAgICB0aGlzLml0ZW1zLnNwbGljZShpZHgsIDEpO1xuICAgICAgICB9XG5cbiAgICAgICAgdGhpcy5ncmlkTGlzdC5wdWxsSXRlbXNUb0xlZnQoKTtcbiAgICAgICAgdGhpcy5yZW5kZXIoKTtcbiAgICB9XG5cbiAgICBvblN0b3AoaXRlbTogR3JpZExpc3RJdGVtKSB7XG4gICAgICAgIHRoaXMuY3VycmVudEVsZW1lbnQgPSB1bmRlZmluZWQ7XG4gICAgICAgIHRoaXMudXBkYXRlQ2FjaGVkSXRlbXMoKTtcbiAgICAgICAgdGhpcy5wcmV2aW91c0RyYWdQb3NpdGlvbiA9IG51bGw7XG5cbiAgICAgICAgdGhpcy5yZW1vdmVQb3NpdGlvbkhpZ2hsaWdodCgpO1xuXG4gICAgICAgIHRoaXMuZ3JpZExpc3QucHVsbEl0ZW1zVG9MZWZ0KGl0ZW0pO1xuXG4gICAgICAgIHRoaXMuZ3JpZHN0ZXJDb21wb25lbnQuaXNEcmFnZ2luZyA9IGZhbHNlO1xuXG4gICAgICAgIHRoaXMucmVmcmVzaExpbmVzKCk7XG4gICAgfVxuXG4gICAgY2FsY3VsYXRlQ2VsbFNpemUoKSB7XG4gICAgICAgIGlmICh0aGlzLm9wdGlvbnMuZGlyZWN0aW9uID09PSAnaG9yaXpvbnRhbCcpIHtcbiAgICAgICAgICAgIHRoaXMuY2VsbEhlaWdodCA9IHRoaXMuY2FsY3VsYXRlQ2VsbEhlaWdodCgpO1xuICAgICAgICAgICAgdGhpcy5jZWxsV2lkdGggPSB0aGlzLm9wdGlvbnMuY2VsbFdpZHRoIHx8IHRoaXMuY2VsbEhlaWdodCAqIHRoaXMub3B0aW9ucy53aWR0aEhlaWdodFJhdGlvO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdGhpcy5jZWxsV2lkdGggPSB0aGlzLmNhbGN1bGF0ZUNlbGxXaWR0aCgpO1xuICAgICAgICAgICAgdGhpcy5jZWxsSGVpZ2h0ID0gdGhpcy5vcHRpb25zLmNlbGxIZWlnaHQgfHwgdGhpcy5jZWxsV2lkdGggLyB0aGlzLm9wdGlvbnMud2lkdGhIZWlnaHRSYXRpbztcbiAgICAgICAgfVxuICAgICAgICBpZiAodGhpcy5vcHRpb25zLmhlaWdodFRvRm9udFNpemVSYXRpbykge1xuICAgICAgICAgICAgdGhpcy5fZm9udFNpemUgPSB0aGlzLmNlbGxIZWlnaHQgKiB0aGlzLm9wdGlvbnMuaGVpZ2h0VG9Gb250U2l6ZVJhdGlvO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgYXBwbHlQb3NpdGlvblRvSXRlbXMoaW5jcmVhc2VHcmlkc3RlclNpemU/KSB7XG4gICAgICAgIGlmICghdGhpcy5vcHRpb25zLnNocmluaykge1xuICAgICAgICAgICAgaW5jcmVhc2VHcmlkc3RlclNpemUgPSB0cnVlO1xuICAgICAgICB9XG4gICAgICAgIC8vIFRPRE86IEltcGxlbWVudCBncm91cCBzZXBhcmF0b3JzXG4gICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdGhpcy5pdGVtcy5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgLy8gRG9uJ3QgaW50ZXJmZXJlIHdpdGggdGhlIHBvc2l0aW9ucyBvZiB0aGUgZHJhZ2dlZCBpdGVtc1xuICAgICAgICAgICAgaWYgKHRoaXMuaXNDdXJyZW50RWxlbWVudCh0aGlzLml0ZW1zW2ldLiRlbGVtZW50KSkge1xuICAgICAgICAgICAgICAgIGNvbnRpbnVlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdGhpcy5pdGVtc1tpXS5hcHBseVBvc2l0aW9uKHRoaXMpO1xuICAgICAgICB9XG5cbiAgICAgICAgY29uc3QgY2hpbGQgPSA8SFRNTEVsZW1lbnQ+dGhpcy5ncmlkc3RlckNvbXBvbmVudC4kZWxlbWVudC5maXJzdENoaWxkO1xuICAgICAgICAvLyBVcGRhdGUgdGhlIHdpZHRoIG9mIHRoZSBlbnRpcmUgZ3JpZCBjb250YWluZXIgd2l0aCBlbm91Z2ggcm9vbSBvbiB0aGVcbiAgICAgICAgLy8gcmlnaHQgdG8gYWxsb3cgZHJhZ2dpbmcgaXRlbXMgdG8gdGhlIGVuZCBvZiB0aGUgZ3JpZC5cbiAgICAgICAgaWYgKHRoaXMub3B0aW9ucy5kaXJlY3Rpb24gPT09ICdob3Jpem9udGFsJykge1xuICAgICAgICAgICAgY29uc3QgaW5jcmVhc2VXaWR0aFdpdGggPSAoaW5jcmVhc2VHcmlkc3RlclNpemUpID8gdGhpcy5tYXhJdGVtV2lkdGggOiAwO1xuICAgICAgICAgICAgY2hpbGQuc3R5bGUuaGVpZ2h0ID0gJyc7XG4gICAgICAgICAgICBjaGlsZC5zdHlsZS53aWR0aCA9ICgodGhpcy5ncmlkTGlzdC5ncmlkLmxlbmd0aCArIGluY3JlYXNlV2lkdGhXaXRoKSAqIHRoaXMuY2VsbFdpZHRoKSArICdweCc7XG5cbiAgICAgICAgfSBlbHNlIGlmICh0aGlzLmdyaWRMaXN0LmdyaWQubGVuZ3RoKSB7XG4gICAgICAgICAgICBjb25zdCBpbmNyZWFzZUhlaWdodFdpdGggPSAoaW5jcmVhc2VHcmlkc3RlclNpemUpID8gdGhpcy5tYXhJdGVtSGVpZ2h0IDogMDtcbiAgICAgICAgICAgIGNoaWxkLnN0eWxlLmhlaWdodCA9ICgodGhpcy5ncmlkTGlzdC5ncmlkLmxlbmd0aCArIGluY3JlYXNlSGVpZ2h0V2l0aCkgKiB0aGlzLmNlbGxIZWlnaHQpICsgJ3B4JztcbiAgICAgICAgICAgIGNoaWxkLnN0eWxlLndpZHRoID0gJyc7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICByZWZyZXNoTGluZXMoKSB7XG4gICAgICAgIGNvbnN0IGdyaWRzdGVyQ29udGFpbmVyID0gPEhUTUxFbGVtZW50PnRoaXMuZ3JpZHN0ZXJDb21wb25lbnQuJGVsZW1lbnQuZmlyc3RDaGlsZDtcblxuICAgICAgICBpZiAodGhpcy5vcHRpb25zLmxpbmVzICYmIHRoaXMub3B0aW9ucy5saW5lcy52aXNpYmxlICYmXG4gICAgICAgICAgICAodGhpcy5ncmlkc3RlckNvbXBvbmVudC5pc0RyYWdnaW5nIHx8IHRoaXMuZ3JpZHN0ZXJDb21wb25lbnQuaXNSZXNpemluZyB8fCB0aGlzLm9wdGlvbnMubGluZXMuYWx3YXlzKSkge1xuICAgICAgICAgICAgY29uc3QgbGluZXNDb2xvciA9IHRoaXMub3B0aW9ucy5saW5lcy5jb2xvciB8fCAnI2Q4ZDhkOCc7XG4gICAgICAgICAgICBjb25zdCBsaW5lc0JnQ29sb3IgPSB0aGlzLm9wdGlvbnMubGluZXMuYmFja2dyb3VuZENvbG9yIHx8ICd0cmFuc3BhcmVudCc7XG4gICAgICAgICAgICBjb25zdCBsaW5lc1dpZHRoID0gdGhpcy5vcHRpb25zLmxpbmVzLndpZHRoIHx8IDE7XG4gICAgICAgICAgICBjb25zdCBiZ1Bvc2l0aW9uID0gbGluZXNXaWR0aCAvIDI7XG5cbiAgICAgICAgICAgIGdyaWRzdGVyQ29udGFpbmVyLnN0eWxlLmJhY2tncm91bmRTaXplID0gYCR7dGhpcy5jZWxsV2lkdGh9cHggJHt0aGlzLmNlbGxIZWlnaHR9cHhgO1xuICAgICAgICAgICAgZ3JpZHN0ZXJDb250YWluZXIuc3R5bGUuYmFja2dyb3VuZFBvc2l0aW9uID0gYC0ke2JnUG9zaXRpb259cHggLSR7YmdQb3NpdGlvbn1weGA7XG4gICAgICAgICAgICBncmlkc3RlckNvbnRhaW5lci5zdHlsZS5iYWNrZ3JvdW5kSW1hZ2UgPSBgXG4gICAgICAgICAgICAgICAgbGluZWFyLWdyYWRpZW50KHRvIHJpZ2h0LCAke2xpbmVzQ29sb3J9ICR7bGluZXNXaWR0aH1weCwgJHtsaW5lc0JnQ29sb3J9ICR7bGluZXNXaWR0aH1weCksXG4gICAgICAgICAgICAgICAgbGluZWFyLWdyYWRpZW50KHRvIGJvdHRvbSwgJHtsaW5lc0NvbG9yfSAke2xpbmVzV2lkdGh9cHgsICR7bGluZXNCZ0NvbG9yfSAke2xpbmVzV2lkdGh9cHgpXG4gICAgICAgICAgICBgO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgZ3JpZHN0ZXJDb250YWluZXIuc3R5bGUuYmFja2dyb3VuZFNpemUgPSAnJztcbiAgICAgICAgICAgIGdyaWRzdGVyQ29udGFpbmVyLnN0eWxlLmJhY2tncm91bmRQb3NpdGlvbiA9ICcnO1xuICAgICAgICAgICAgZ3JpZHN0ZXJDb250YWluZXIuc3R5bGUuYmFja2dyb3VuZEltYWdlID0gJyc7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBwcml2YXRlIHJlbW92ZUl0ZW1Gcm9tQ2FjaGUoaXRlbTogR3JpZExpc3RJdGVtKSB7XG4gICAgICAgIHRoaXMuX2l0ZW1zID0gdGhpcy5faXRlbXNcbiAgICAgICAgICAgIC5maWx0ZXIoY2FjaGVkSXRlbSA9PiBjYWNoZWRJdGVtLiRlbGVtZW50ICE9PSBpdGVtLiRlbGVtZW50KTtcblxuICAgICAgICBPYmplY3Qua2V5cyh0aGlzLl9pdGVtc01hcClcbiAgICAgICAgICAgIC5mb3JFYWNoKChicmVha3BvaW50OiBzdHJpbmcpID0+IHtcbiAgICAgICAgICAgICAgICB0aGlzLl9pdGVtc01hcFticmVha3BvaW50XSA9IHRoaXMuX2l0ZW1zTWFwW2JyZWFrcG9pbnRdXG4gICAgICAgICAgICAgICAgICAgIC5maWx0ZXIoY2FjaGVkSXRlbSA9PiBjYWNoZWRJdGVtLiRlbGVtZW50ICE9PSBpdGVtLiRlbGVtZW50KTtcbiAgICAgICAgICAgIH0pO1xuICAgIH1cblxuICAgIHByaXZhdGUgY29weUl0ZW1zKCk6IHZvaWQge1xuICAgICAgICB0aGlzLl9pdGVtcyA9IHRoaXMuaXRlbXNcbiAgICAgICAgICAgIC5maWx0ZXIoaXRlbSA9PiB0aGlzLmlzVmFsaWRHcmlkSXRlbShpdGVtKSlcbiAgICAgICAgICAgIC5tYXAoKGl0ZW06IEdyaWRMaXN0SXRlbSkgPT4ge1xuICAgICAgICAgICAgICAgIHJldHVybiBpdGVtLmNvcHlGb3JCcmVha3BvaW50KG51bGwpO1xuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgdGhpcy5ncmlkc3Rlck9wdGlvbnMucmVzcG9uc2l2ZU9wdGlvbnMuZm9yRWFjaCgob3B0aW9uczogSUdyaWRzdGVyT3B0aW9ucykgPT4ge1xuICAgICAgICAgICAgdGhpcy5faXRlbXNNYXBbb3B0aW9ucy5icmVha3BvaW50XSA9IHRoaXMuaXRlbXNcbiAgICAgICAgICAgICAgICAuZmlsdGVyKGl0ZW0gPT4gdGhpcy5pc1ZhbGlkR3JpZEl0ZW0oaXRlbSkpXG4gICAgICAgICAgICAgICAgLm1hcCgoaXRlbTogR3JpZExpc3RJdGVtKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBpdGVtLmNvcHlGb3JCcmVha3BvaW50KG9wdGlvbnMuYnJlYWtwb2ludCk7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgIH0pO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFVwZGF0ZSBtYXhJdGVtV2lkdGggYW5kIG1heEl0ZW1IZWlnaHQgdmFsZXMgYWNjb3JkaW5nIHRvIGN1cnJlbnQgc3RhdGUgb2YgaXRlbXNcbiAgICAgKi9cbiAgICBwcml2YXRlIHVwZGF0ZU1heEl0ZW1TaXplKCkge1xuICAgICAgICB0aGlzLm1heEl0ZW1XaWR0aCA9IE1hdGgubWF4LmFwcGx5KFxuICAgICAgICAgICAgbnVsbCwgdGhpcy5pdGVtcy5tYXAoKGl0ZW0pID0+IHtcbiAgICAgICAgICAgICAgICByZXR1cm4gaXRlbS53O1xuICAgICAgICAgICAgfSkpO1xuICAgICAgICB0aGlzLm1heEl0ZW1IZWlnaHQgPSBNYXRoLm1heC5hcHBseShcbiAgICAgICAgICAgIG51bGwsIHRoaXMuaXRlbXMubWFwKChpdGVtKSA9PiB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGl0ZW0uaDtcbiAgICAgICAgICAgIH0pKTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBVcGRhdGUgaXRlbXMgcHJvcGVydGllcyBvZiBwcmV2aW91c2x5IGNhY2hlZCBpdGVtc1xuICAgICAqL1xuICAgIHByaXZhdGUgcmVzdG9yZUNhY2hlZEl0ZW1zKCkge1xuICAgICAgICBjb25zdCBpdGVtcyA9IHRoaXMub3B0aW9ucy5icmVha3BvaW50ID8gdGhpcy5faXRlbXNNYXBbdGhpcy5vcHRpb25zLmJyZWFrcG9pbnRdIDogdGhpcy5faXRlbXM7XG5cbiAgICAgICAgdGhpcy5pdGVtc1xuICAgICAgICAgICAgLmZpbHRlcihpdGVtID0+IHRoaXMuaXNWYWxpZEdyaWRJdGVtKGl0ZW0pKVxuICAgICAgICAgICAgLmZvckVhY2goKGl0ZW06IEdyaWRMaXN0SXRlbSkgPT4ge1xuICAgICAgICAgICAgICAgIGNvbnN0IGNhY2hlZEl0ZW06IEdyaWRMaXN0SXRlbSA9IGl0ZW1zLmZpbHRlcihjYWNoZWRJdG0gPT4ge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gY2FjaGVkSXRtLiRlbGVtZW50ID09PSBpdGVtLiRlbGVtZW50O1xuICAgICAgICAgICAgICAgIH0pWzBdO1xuXG4gICAgICAgICAgICAgICAgaXRlbS54ID0gY2FjaGVkSXRlbS54O1xuICAgICAgICAgICAgICAgIGl0ZW0ueSA9IGNhY2hlZEl0ZW0ueTtcblxuICAgICAgICAgICAgICAgIGl0ZW0udyA9IGNhY2hlZEl0ZW0udztcbiAgICAgICAgICAgICAgICBpdGVtLmggPSBjYWNoZWRJdGVtLmg7XG4gICAgICAgICAgICAgICAgaXRlbS5hdXRvU2l6ZSA9IGNhY2hlZEl0ZW0uYXV0b1NpemU7XG4gICAgICAgICAgICB9KTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBJZiBpdGVtIHNob3VsZCByZWFjdCBvbiBncmlkXG4gICAgICogQHBhcmFtIEdyaWRMaXN0SXRlbSBpdGVtXG4gICAgICogQHJldHVybnMgYm9vbGVhblxuICAgICAqL1xuICAgIHByaXZhdGUgaXNWYWxpZEdyaWRJdGVtKGl0ZW06IEdyaWRMaXN0SXRlbSk6IGJvb2xlYW4ge1xuICAgICAgICBpZiAodGhpcy5vcHRpb25zLmRpcmVjdGlvbiA9PT0gJ25vbmUnKSB7XG4gICAgICAgICAgICByZXR1cm4gISFpdGVtLml0ZW1Db21wb25lbnQ7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBjYWxjdWxhdGVDZWxsV2lkdGgoKSB7XG4gICAgICAgIGNvbnN0IGdyaWRzdGVyV2lkdGggPSBwYXJzZUZsb2F0KHdpbmRvdy5nZXRDb21wdXRlZFN0eWxlKHRoaXMuZ3JpZHN0ZXJDb21wb25lbnQuJGVsZW1lbnQpLndpZHRoKTtcblxuICAgICAgICByZXR1cm4gZ3JpZHN0ZXJXaWR0aCAvIHRoaXMub3B0aW9ucy5sYW5lcztcbiAgICB9XG5cbiAgICBwcml2YXRlIGNhbGN1bGF0ZUNlbGxIZWlnaHQoKSB7XG4gICAgICAgIGNvbnN0IGdyaWRzdGVySGVpZ2h0ID0gcGFyc2VGbG9hdCh3aW5kb3cuZ2V0Q29tcHV0ZWRTdHlsZSh0aGlzLmdyaWRzdGVyQ29tcG9uZW50LiRlbGVtZW50KS5oZWlnaHQpO1xuXG4gICAgICAgIHJldHVybiBncmlkc3RlckhlaWdodCAvIHRoaXMub3B0aW9ucy5sYW5lcztcbiAgICB9XG5cbiAgICBwcml2YXRlIGFwcGx5U2l6ZVRvSXRlbXMoKSB7XG4gICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdGhpcy5pdGVtcy5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgdGhpcy5pdGVtc1tpXS5hcHBseVNpemUoKTtcblxuICAgICAgICAgICAgaWYgKHRoaXMub3B0aW9ucy5oZWlnaHRUb0ZvbnRTaXplUmF0aW8pIHtcbiAgICAgICAgICAgICAgICB0aGlzLml0ZW1zW2ldLiRlbGVtZW50LnN0eWxlWydmb250LXNpemUnXSA9IHRoaXMuX2ZvbnRTaXplO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBpc0N1cnJlbnRFbGVtZW50KGVsZW1lbnQpIHtcbiAgICAgICAgaWYgKCF0aGlzLmN1cnJlbnRFbGVtZW50KSB7XG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGVsZW1lbnQgPT09IHRoaXMuY3VycmVudEVsZW1lbnQ7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBzbmFwSXRlbVNpemVUb0dyaWQoaXRlbTogR3JpZExpc3RJdGVtKTogQXJyYXk8bnVtYmVyPiB7XG4gICAgICAgIGNvbnN0IGl0ZW1TaXplID0ge1xuICAgICAgICAgICAgd2lkdGg6IHBhcnNlSW50KGl0ZW0uJGVsZW1lbnQuc3R5bGUud2lkdGgsIDEwKSAtIDEsXG4gICAgICAgICAgICBoZWlnaHQ6IHBhcnNlSW50KGl0ZW0uJGVsZW1lbnQuc3R5bGUuaGVpZ2h0LCAxMCkgLSAxXG4gICAgICAgIH07XG5cbiAgICAgICAgbGV0IGNvbFNpemUgPSBNYXRoLnJvdW5kKGl0ZW1TaXplLndpZHRoIC8gdGhpcy5jZWxsV2lkdGgpO1xuICAgICAgICBsZXQgcm93U2l6ZSA9IE1hdGgucm91bmQoaXRlbVNpemUuaGVpZ2h0IC8gdGhpcy5jZWxsSGVpZ2h0KTtcblxuICAgICAgICAvLyBLZWVwIGl0ZW0gbWluaW11bSAxXG4gICAgICAgIGNvbFNpemUgPSBNYXRoLm1heChjb2xTaXplLCAxKTtcbiAgICAgICAgcm93U2l6ZSA9IE1hdGgubWF4KHJvd1NpemUsIDEpO1xuXG4gICAgICAgIC8vIGNoZWNrIGlmIGVsZW1lbnQgaXMgcGlubmVkXG4gICAgICAgIGlmICh0aGlzLmdyaWRMaXN0LmlzT3ZlckZpeGVkQXJlYShpdGVtLngsIGl0ZW0ueSwgY29sU2l6ZSwgcm93U2l6ZSwgaXRlbSkpIHtcbiAgICAgICAgICAgIHJldHVybiBbaXRlbS53LCBpdGVtLmhdO1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIFtjb2xTaXplLCByb3dTaXplXTtcbiAgICB9XG5cbiAgICBwcml2YXRlIGdlbmVyYXRlSXRlbVBvc2l0aW9uKGl0ZW06IEdyaWRMaXN0SXRlbSk6IHsgeDogbnVtYmVyLCB5OiBudW1iZXIgfSB7XG4gICAgICAgIGxldCBwb3NpdGlvbjtcblxuICAgICAgICBpZiAoaXRlbS5pdGVtUHJvdG90eXBlKSB7XG4gICAgICAgICAgICBjb25zdCBjb29yZHMgPSBpdGVtLml0ZW1Qcm90b3R5cGUuZ2V0UG9zaXRpb25Ub0dyaWRzdGVyKHRoaXMpO1xuICAgICAgICAgICAgcG9zaXRpb24gPSB7XG4gICAgICAgICAgICAgICAgeDogTWF0aC5yb3VuZChjb29yZHMueCAvIHRoaXMuY2VsbFdpZHRoKSxcbiAgICAgICAgICAgICAgICB5OiBNYXRoLnJvdW5kKGNvb3Jkcy55IC8gdGhpcy5jZWxsSGVpZ2h0KVxuICAgICAgICAgICAgfTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHBvc2l0aW9uID0ge1xuICAgICAgICAgICAgICAgIHg6IE1hdGgucm91bmQoaXRlbS5wb3NpdGlvblggLyB0aGlzLmNlbGxXaWR0aCksXG4gICAgICAgICAgICAgICAgeTogTWF0aC5yb3VuZChpdGVtLnBvc2l0aW9uWSAvIHRoaXMuY2VsbEhlaWdodClcbiAgICAgICAgICAgIH07XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gcG9zaXRpb247XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBzbmFwSXRlbVBvc2l0aW9uVG9HcmlkKGl0ZW06IEdyaWRMaXN0SXRlbSkge1xuICAgICAgICBjb25zdCBwb3NpdGlvbiA9IHRoaXMuZ2VuZXJhdGVJdGVtUG9zaXRpb24oaXRlbSk7XG4gICAgICAgIGxldCBjb2wgPSBwb3NpdGlvbi54O1xuICAgICAgICBsZXQgcm93ID0gcG9zaXRpb24ueTtcblxuICAgICAgICAvLyBLZWVwIGl0ZW0gcG9zaXRpb24gd2l0aGluIHRoZSBncmlkIGFuZCBkb24ndCBsZXQgdGhlIGl0ZW0gY3JlYXRlIG1vcmVcbiAgICAgICAgLy8gdGhhbiBvbmUgZXh0cmEgY29sdW1uXG4gICAgICAgIGNvbCA9IE1hdGgubWF4KGNvbCwgMCk7XG4gICAgICAgIHJvdyA9IE1hdGgubWF4KHJvdywgMCk7XG5cbiAgICAgICAgaWYgKHRoaXMub3B0aW9ucy5kaXJlY3Rpb24gPT09ICdob3Jpem9udGFsJykge1xuICAgICAgICAgICAgY29sID0gTWF0aC5taW4oY29sLCB0aGlzLl9tYXhHcmlkQ29scyk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBjb2wgPSBNYXRoLm1pbihjb2wsIE1hdGgubWF4KDAsIHRoaXMub3B0aW9ucy5sYW5lcyAtIGl0ZW0udykpO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gY2hlY2sgaWYgZWxlbWVudCBpcyBwaW5uZWRcbiAgICAgICAgaWYgKHRoaXMuZ3JpZExpc3QuaXNPdmVyRml4ZWRBcmVhKGNvbCwgcm93LCBpdGVtLncsIGl0ZW0uaCkpIHtcbiAgICAgICAgICAgIHJldHVybiBbaXRlbS54LCBpdGVtLnldO1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIFtjb2wsIHJvd107XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBkcmFnU2l6ZUNoYW5nZWQobmV3U2l6ZSk6IGJvb2xlYW4ge1xuICAgICAgICBpZiAoIXRoaXMucHJldmlvdXNEcmFnU2l6ZSkge1xuICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIChuZXdTaXplWzBdICE9PSB0aGlzLnByZXZpb3VzRHJhZ1NpemVbMF0gfHxcbiAgICAgICAgICAgIG5ld1NpemVbMV0gIT09IHRoaXMucHJldmlvdXNEcmFnU2l6ZVsxXSk7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBkcmFnUG9zaXRpb25DaGFuZ2VkKG5ld1Bvc2l0aW9uKTogYm9vbGVhbiB7XG4gICAgICAgIGlmICghdGhpcy5wcmV2aW91c0RyYWdQb3NpdGlvbikge1xuICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIChuZXdQb3NpdGlvblswXSAhPT0gdGhpcy5wcmV2aW91c0RyYWdQb3NpdGlvblswXSB8fFxuICAgICAgICAgICAgbmV3UG9zaXRpb25bMV0gIT09IHRoaXMucHJldmlvdXNEcmFnUG9zaXRpb25bMV0pO1xuICAgIH1cblxuICAgIHByaXZhdGUgaGlnaGxpZ2h0UG9zaXRpb25Gb3JJdGVtKGl0ZW0pIHtcbiAgICAgICAgY29uc3Qgc2l6ZSA9IGl0ZW0uY2FsY3VsYXRlU2l6ZSh0aGlzKTtcbiAgICAgICAgY29uc3QgcG9zaXRpb24gPSBpdGVtLmNhbGN1bGF0ZVBvc2l0aW9uKHRoaXMpO1xuXG4gICAgICAgIHRoaXMuJHBvc2l0aW9uSGlnaGxpZ2h0LnN0eWxlLndpZHRoID0gc2l6ZS53aWR0aCArICdweCc7XG4gICAgICAgIHRoaXMuJHBvc2l0aW9uSGlnaGxpZ2h0LnN0eWxlLmhlaWdodCA9IHNpemUuaGVpZ2h0ICsgJ3B4JztcbiAgICAgICAgdGhpcy4kcG9zaXRpb25IaWdobGlnaHQuc3R5bGUubGVmdCA9IHBvc2l0aW9uLmxlZnQgKyAncHgnO1xuICAgICAgICB0aGlzLiRwb3NpdGlvbkhpZ2hsaWdodC5zdHlsZS50b3AgPSBwb3NpdGlvbi50b3AgKyAncHgnO1xuICAgICAgICB0aGlzLiRwb3NpdGlvbkhpZ2hsaWdodC5zdHlsZS5kaXNwbGF5ID0gJyc7XG5cbiAgICAgICAgaWYgKHRoaXMub3B0aW9ucy5oZWlnaHRUb0ZvbnRTaXplUmF0aW8pIHtcbiAgICAgICAgICAgIHRoaXMuJHBvc2l0aW9uSGlnaGxpZ2h0LnN0eWxlWydmb250LXNpemUnXSA9IHRoaXMuX2ZvbnRTaXplO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgcHVibGljIHVwZGF0ZUNhY2hlZEl0ZW1zKCkge1xuICAgICAgICAvLyBOb3RpZnkgdGhlIHVzZXIgd2l0aCB0aGUgaXRlbXMgdGhhdCBjaGFuZ2VkIHNpbmNlIHRoZSBwcmV2aW91cyBzbmFwc2hvdFxuICAgICAgICB0aGlzLnRyaWdnZXJPbkNoYW5nZShudWxsKTtcbiAgICAgICAgdGhpcy5ncmlkc3Rlck9wdGlvbnMucmVzcG9uc2l2ZU9wdGlvbnMuZm9yRWFjaCgob3B0aW9uczogSUdyaWRzdGVyT3B0aW9ucykgPT4ge1xuICAgICAgICAgICAgdGhpcy50cmlnZ2VyT25DaGFuZ2Uob3B0aW9ucy5icmVha3BvaW50KTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgdGhpcy5jb3B5SXRlbXMoKTtcbiAgICB9XG5cbiAgICBwcml2YXRlIHRyaWdnZXJPbkNoYW5nZShicmVha3BvaW50Pykge1xuICAgICAgICBjb25zdCBpdGVtcyA9IGJyZWFrcG9pbnQgPyB0aGlzLl9pdGVtc01hcFticmVha3BvaW50XSA6IHRoaXMuX2l0ZW1zO1xuICAgICAgICBjb25zdCBjaGFuZ2VJdGVtcyA9IHRoaXMuZ3JpZExpc3QuZ2V0Q2hhbmdlZEl0ZW1zKGl0ZW1zIHx8IFtdLCBicmVha3BvaW50KTtcblxuICAgICAgICBjaGFuZ2VJdGVtc1xuICAgICAgICAgICAgLmZpbHRlcigoaXRlbUNoYW5nZTogYW55KSA9PiB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGl0ZW1DaGFuZ2UuaXRlbS5pdGVtQ29tcG9uZW50O1xuICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIC5mb3JFYWNoKChpdGVtQ2hhbmdlOiBhbnkpID0+IHtcblxuICAgICAgICAgICAgICAgIGlmIChpdGVtQ2hhbmdlLmNoYW5nZXMuaW5kZXhPZigneCcpID49IDApIHtcbiAgICAgICAgICAgICAgICAgICAgaXRlbUNoYW5nZS5pdGVtLnRyaWdnZXJDaGFuZ2VYKGJyZWFrcG9pbnQpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBpZiAoaXRlbUNoYW5nZS5jaGFuZ2VzLmluZGV4T2YoJ3knKSA+PSAwKSB7XG4gICAgICAgICAgICAgICAgICAgIGl0ZW1DaGFuZ2UuaXRlbS50cmlnZ2VyQ2hhbmdlWShicmVha3BvaW50KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgaWYgKGl0ZW1DaGFuZ2UuY2hhbmdlcy5pbmRleE9mKCd3JykgPj0gMCkge1xuICAgICAgICAgICAgICAgICAgICBpdGVtQ2hhbmdlLml0ZW0udHJpZ2dlckNoYW5nZVcoYnJlYWtwb2ludCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGlmIChpdGVtQ2hhbmdlLmNoYW5nZXMuaW5kZXhPZignaCcpID49IDApIHtcbiAgICAgICAgICAgICAgICAgICAgaXRlbUNoYW5nZS5pdGVtLnRyaWdnZXJDaGFuZ2VIKGJyZWFrcG9pbnQpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAvLyBzaG91bGQgYmUgY2FsbGVkIG9ubHkgb25jZSAobm90IGZvciBlYWNoIGJyZWFrcG9pbnQpXG4gICAgICAgICAgICAgICAgaXRlbUNoYW5nZS5pdGVtLml0ZW1Db21wb25lbnQuY2hhbmdlLmVtaXQoe1xuICAgICAgICAgICAgICAgICAgICBpdGVtOiBpdGVtQ2hhbmdlLml0ZW0sXG4gICAgICAgICAgICAgICAgICAgIG9sZFZhbHVlczogaXRlbUNoYW5nZS5vbGRWYWx1ZXMgfHwge30sXG4gICAgICAgICAgICAgICAgICAgIGlzTmV3OiBpdGVtQ2hhbmdlLmlzTmV3LFxuICAgICAgICAgICAgICAgICAgICBjaGFuZ2VzOiBpdGVtQ2hhbmdlLmNoYW5nZXMsXG4gICAgICAgICAgICAgICAgICAgIGJyZWFrcG9pbnQ6IGJyZWFrcG9pbnRcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH0pO1xuICAgIH1cblxuICAgIHByaXZhdGUgcmVtb3ZlUG9zaXRpb25IaWdobGlnaHQoKSB7XG4gICAgICAgIHRoaXMuJHBvc2l0aW9uSGlnaGxpZ2h0LnN0eWxlLmRpc3BsYXkgPSAnbm9uZSc7XG4gICAgfVxuXG59XG4iXX0=